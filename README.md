# 제조 공정 데이터 기반 AI 이상 탐지 파이프라인
> 반도체 제조 공정 센서 데이터에서 불량을 조기 탐지하는 end-to-end AI 파이프라인

## 📌 프로젝트 개요
실제 반도체 제조 현장(SECOM)의 센서 데이터를 활용해 불량을 사전에 탐지하는
AI 모델과 자동화 파이프라인을 구축했습니다.

단순 모델 구현에 그치지 않고 아래 세 가지에 집중했습니다.
- 새 데이터가 입력되면 전처리 → 예측 → 결과 저장까지 자동 실행되는 파이프라인
- 하이퍼파라미터 튜닝을 통한 성능 개선 시도 및 한계 분석
- 탐지 실패 불량 13개의 원인을 정량적으로 규명

## 🔍 문제 정의
- 제조 공정에서 불량 샘플 비율이 **6.6%** 에 불과한 극심한 클래스 불균형
- 590개 센서 피처 중 대부분에 결측치 존재 (일부 91% 결측)
- 단순 정확도(Accuracy) 93%는 의미 없음 → **Recall, F1을 핵심 지표로 선택**
- 이유: 제조 현장에서 불량 미탐지가 과탐지보다 훨씬 위험 (리콜, 안전사고)

## 📊 데이터
| 항목 | 내용 |
|------|------|
| 출처 | UCI SECOM Dataset |
| 샘플 수 | 1,567개 |
| 피처 수 | 590개 센서 피처 |
| 불량 비율 | 6.6% (정상 1,463개 / 불량 104개) |
| 불균형 비율 | 14.1 : 1 |

## ⚙️ 기술 스택
- **언어:** Python 3.11
- **라이브러리:** pandas, numpy, scikit-learn, XGBoost, imbalanced-learn, matplotlib, seaborn
- **버전 관리:** Git / GitHub

## 🔄 파이프라인 구조
```
Raw Data (590 피처)
→ [전처리] 결측치 80% 이상 삭제 + 중앙값 대체 + 분산0 제거 + 정규화
→ 466개 피처
→ [불균형 해소] SMOTE (불량 83개 → 1,170개)
→ [모델링] XGBoost + Isolation Forest 앙상블
→ [임계값 최적화] 0.25 적용 (Recall 우선)
→ 예측 결과 CSV 저장 + 분석 리포트 자동 생성
```

## 🧠 모델링 전략

### 1단계: 클래스 불균형 처리
- 불량 83개 → SMOTE로 1,170개 생성 (1:1 균형)
- 단순 복사가 아닌 기존 샘플 간 보간으로 가상 샘플 생성
- 테스트 데이터는 현실 비율 유지 (SMOTE 미적용)

### 2단계: 앙상블 구성
| 모델 | 특징 | 단독 성능 |
|------|------|-----------|
| XGBoost | 지도학습 기반 불량 분류 | ROC-AUC 0.705 |
| Isolation Forest | 비지도학습 기반 이상 탐지 | ROC-AUC 0.559 |
| **앙상블** | **두 모델 확률 평균** | **ROC-AUC 0.676** |

### 3단계: 임계값 최적화
- 기본 임계값 0.5 → 불량 탐지 0개
- 임계값 0.25로 조정 → Recall 0.38로 향상
- 제조 품질 특성: False Negative > False Positive 위험

### 4단계: 하이퍼파라미터 튜닝
- GridSearchCV로 405개 조합 탐색 (5-fold CV)
- 최적 파라미터: learning_rate=0.1, max_depth=5, n_estimators=100
- **결과: 초기 설정값이 이미 최적** → 성능 한계가 파라미터가 아닌 데이터 특성에서 기인

## 📈 최종 성능
| 지표 | 값 |
|------|-----|
| ROC-AUC | 0.676 |
| Defect Recall | 0.381 |
| Defect F1 | 0.219 |
| Normal Precision | 0.950 |

## 🔎 실패 분석 (핵심 인사이트)
탐지 실패한 불량 13개의 원인을 정량적으로 분석했습니다.

| 구분 | 정상과의 센서값 차이 | 해석 |
|------|-------------------|----|
| 탐지 성공 (8개) | 평균 2.0 이상 | 정상과 명확히 구별되는 패턴 |
| 탐지 실패 (13개) | 평균 0.02~0.23 | 정상 범위 내에 존재 |

**결론:** 탐지 실패 불량은 센서값이 정상 범위 안에 있는 **잠복 불량**으로, 현재 센서 데이터만으로는 구별 불가능합니다.

**개선 방향:**
- 추가 센서 도입으로 잠복 불량 감지
- 시계열 데이터 활용 (순간값이 아닌 추세 분석)
- 공정 파라미터 등 외부 데이터 결합

## 📁 프로젝트 구조
```
├── data/
│   ├── secom.data
│   ├── secom_labels.data
│   └── secom_preprocessed.csv
├── notebooks/
│   ├── 01_eda.ipynb
│   ├── 02_preprocessing.ipynb
│   ├── 03_modeling.ipynb
│   └── 04_failure_analysis.ipynb
├── src/
│   ├── pipeline.py
│   ├── predict.py
│   └── report.py
├── models/
│   ├── xgb_model.pkl
│   ├── iso_forest.pkl
│   └── scaler_iso.pkl
├── reports/
│   ├── final_report.png
│   ├── failure_analysis.png
│   └── confusion_matrix.png
├── docs/
│   └── log.md
└── README.md
```

## 🚀 실행 방법
```bash
# 예측 실행
python src/predict.py

# 리포트 생성
python src/report.py
```

## 💡 핵심 인사이트
1. **도메인 이해가 먼저** - 불량 미탐지가 과탐지보다 위험한 제조 특성 반영
2. **지표 선택의 중요성** - Accuracy 93%는 의미없음, Recall/F1이 핵심
3. **앙상블 효과** - 지도/비지도 학습 결합으로 단일 모델 한계 보완
4. **튜닝의 한계 인식** - 성능 한계가 파라미터가 아닌 데이터 자체에서 기인함을 증명
5. **잠복 불량 발견** - 탐지 실패 원인을 정량적으로 규명, 추가 센서 필요성 도출

## 📝 작업 로그
[docs/log.md](docs/log.md) 참고